extends ../../layouts/layoutDefault.pug

block content
  .container.mt-5
    .row
      // Cột hiển thị hình ảnh sản phẩm
      .col-md-6
        if product.thumbnail
          img.img-fluid.rounded.shadow(
            src=product.thumbnail, 
            alt=product.title, 
            style="max-height: 400px; object-fit: cover;"
          )
        else
          .d-flex.align-items-center.justify-content-center.bg-light.rounded.shadow(style="height: 400px;")
            i.fas.fa-image.text-muted.fa-5x

      // Cột hiển thị thông tin sản phẩm
      .col-md-6
        h2.mb-3= product.title

        // Trạng thái sản phẩm
        if product.status === 'active'
          span.badge.badge-success.mb-2 Đang bán
        else if product.status === 'inactive'
          span.badge.badge-warning.mb-2 Tạm ngưng
        else
          span.badge.badge-secondary.mb-2 Không xác định


        // Giá và giảm giá
        .price-section.mb-3
          if product.discountPercentage && product.discountPercentage > 0
            - var originalPrice = product.price
            - var discountedPrice = product.price * (1 - product.discountPercentage / 100)
            h4.text-danger.mb-1 
              | $#{discountedPrice.toFixed(2)}
              span.badge.badge-danger.ml-2 -#{product.discountPercentage}%
            p.text-muted
              s $#{originalPrice}
          else
            h4.text-danger.mb-1 $#{product.price}

        // Tồn kho
        .stock-info.mb-3
          strong Tồn kho:
          if product.stock > 0
            span.text-success #{product.stock} sản phẩm
          else
            span.text-danger Hết hàng

        // Mô tả
        if product.description
          p
            strong Mô tả:
          .description-content.mb-3 !{product.description}

        // Ngày tạo & cập nhật
        .product-dates.mb-3
          if product.createdAt
            p.text-muted.small
              strong Ngày tạo:
              | #{new Date(product.createdAt.$date || product.createdAt).toLocaleDateString('vi-VN')}
          if product.updatedAt
            p.text-muted.small
              strong Cập nhật lần cuối:
              | #{new Date(product.updatedAt.$date || product.updatedAt).toLocaleDateString('vi-VN')}

        // Form thêm vào giỏ hàng
        if product.status === 'active' && product.stock > 0 && !product.deleted
          form(action=`/cart/add/${product.id}` method="POST")
            .form-group
              label(for="quantity") Số lượng:
              input.form-control(
                type="number",
                name="quantity",
                id="quantity",
                value="1",
                min="1",
                max=product.stock,
                style="width: 100px; display: inline-block;"
              )
            button.btn.btn-success.btn-lg(type="submit")
              i.fas.fa-cart-plus.mr-2
              | Thêm vào giỏ hàng
        else if product.deleted
          .alert.alert-danger Sản phẩm này đã bị xóa
        else if product.status !== 'active'
          .alert.alert-warning Sản phẩm tạm thời không bán
        else
          .alert.alert-danger Sản phẩm hiện tại hết hàng

        // Nút quay lại
        a.btn.btn-outline-primary.mt-3(href="/products")
          i.fas.fa-arrow-left.mr-2
          | Quay lại danh sách sản phẩm
